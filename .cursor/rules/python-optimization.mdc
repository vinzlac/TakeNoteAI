---
globs: *.py
---

# Python Code Standards for TakeNoteAI

## Mac M4 Optimization Requirements

All Python scripts must include M4 optimizations:

```python
import torch
import os

# Optimisations M4
if torch.backends.mps.is_available():
    torch.set_num_threads(14)
    os.environ['OMP_NUM_THREADS'] = '14'
    os.environ['MKL_NUM_THREADS'] = '14'
    os.environ['NUMEXPR_NUM_THREADS'] = '14'
    print("ğŸš€ Optimisations Mac M4 activÃ©es")
```

## Device Detection Pattern

Use this pattern for device selection:
```python
def _get_optimal_device(self):
    """DÃ©tecte le device optimal pour M4."""
    if torch.backends.mps.is_available():
        print("âœ… GPU M4 dÃ©tectÃ© via MPS")
        return "mps"
    elif torch.cuda.is_available():
        print("âœ… GPU CUDA dÃ©tectÃ©")
        return "cuda"
    else:
        print("âš ï¸  Utilisation CPU uniquement")
        return "cpu"
```

## Error Handling Standards

Always use safe file operations:
```python
def safe_remove_file(file_path):
    """Supprime un fichier en toute sÃ©curitÃ©."""
    try:
        if file_path.exists():
            file_path.unlink()
            print(f"âœ… SupprimÃ©: {file_path.name}")
            return True
        else:
            return True  # Pas d'erreur si le fichier n'existe pas
    except Exception as e:
        print(f"âŒ Erreur lors de la suppression de {file_path.name}: {e}")
        return False
```

## Logging Standards

Use consistent emoji-based logging:
- ğŸš€ for initialization and optimization
- âœ… for success messages
- âŒ for errors
- âš ï¸ for warnings
- ğŸ”§ for configuration
- ğŸ“Š for analysis results
- ğŸ‰ for completion

## Subprocess Usage

When calling other scripts, always use:
```python
result = subprocess.run(cmd, shell=True, capture_output=True, text=True)
if result.returncode == 0:
    print("âœ… Success")
else:
    print(f"âŒ Error: {result.stderr}")
```